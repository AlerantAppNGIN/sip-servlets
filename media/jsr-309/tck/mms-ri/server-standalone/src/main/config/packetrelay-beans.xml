<?xml version="1.0" encoding="UTF-8"?>

<deployment xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="urn:jboss:bean-deployer:2.0 bean-deployer_2_0.xsd"
	xmlns="urn:jboss:bean-deployer:2.0">

	<!-- PACKET RELAY -->


	<bean name="PR-Pipe1"
		class="org.mobicents.media.server.resource.PipeFactory">
		<property name="outlet">dsp</property>
	</bean>
	<bean name="PR-Pipe2"
		class="org.mobicents.media.server.resource.PipeFactory">
		<property name="inlet">dsp</property>
	</bean>

	<bean name="PR-RxChannelFactory"
		class="org.mobicents.media.server.resource.ChannelFactory">
		<property name="components">
			<list>
				<inject bean="DSP" />
			</list>
		</property>
		<property name="pipes">
			<list>
				<inject bean="PR-Pipe1" />
				<inject bean="PR-Pipe2" />
			</list>
		</property>
	</bean>

	<bean name="PR-TxChannelFactory"
		class="org.mobicents.media.server.resource.ChannelFactory">
		<property name="components">
			<list>
				<inject bean="DSP" />
			</list>
		</property>
		<property name="pipes">
			<list>
				<inject bean="PR-Pipe1" />
				<inject bean="PR-Pipe2" />
			</list>
		</property>
	</bean>


        <bean name="PacketRelayConnectionFactory" class="org.mobicents.media.server.ConnectionFactory">
            <property name="txChannelFactory">
                <map class="java.util.Hashtable" keyClass="java.lang.String" valueClass="org.mobicents.media.server.resource.ChannelFactory">
                    <entry>
                        <key>audio</key>
                        <value><inject bean="PR-TxChannelFactory"/></value>
                    </entry>
                </map>
            </property>
            <property name="rxChannelFactory">
                <map class="java.util.Hashtable" keyClass="java.lang.String" valueClass="org.mobicents.media.server.resource.ChannelFactory">
                    <entry>
                        <key>audio</key>
                        <value><inject bean="PR-RxChannelFactory"/></value>
                    </entry>
                </map>
            </property>
        </bean>    

	<bean name="PacketRelayBridgeFactory"
		class="org.mobicents.media.server.impl.resource.prelay.BridgeFactory">
		<property name="name">packet.relay</property>
	</bean>

	<bean name="PacketRelayEndpoint"
		class="org.mobicents.media.server.EndpointImpl">
		<property name="localName">
			/mobicents/media/packetrelay/[1..200]
		</property>
		<property name="timer">
			<inject bean="Timer" />
		</property>
		<property name="rtpFactory">
                    <inject bean="RTPFactory"/>
		</property>
		<property name="connectionFactory">
			<inject bean="PacketRelayConnectionFactory" />
		</property>
		<property name="groupFactory">
			<inject bean="PacketRelayBridgeFactory" />
		</property>
	</bean>


</deployment>
